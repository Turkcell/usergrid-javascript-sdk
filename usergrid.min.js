function isUUID(e){var t=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;if(!e)return false;return t.test(e)}function encodeParams(e){tail=[];var t=[];if(e instanceof Array){for(i in e){t=e[i];if(t instanceof Array&&t.length>1){tail.push(t[0]+"="+encodeURIComponent(t[1]))}}}else{for(var n in e){if(e.hasOwnProperty(n)){var r=e[n];if(r instanceof Array){for(i in r){t=r[i];tail.push(n+"="+encodeURIComponent(t))}}else{tail.push(n+"="+encodeURIComponent(r))}}}}return tail.join("&")}window.console=window.console||{};window.console.log=window.console.log||function(){};window.Usergrid=window.Usergrid||{};Usergrid=Usergrid||{};Usergrid.SDK_VERSION="0.10.04";Usergrid.Client=function(e){this.URI=e.URI||"https://api.usergrid.com";this.orgName=e.orgName;this.appName=e.appName;this.buildCurl=e.buildCurl||false;this.logging=e.logging||false;this._callTimeout=e.callTimeout||3e4;this._callTimeoutCallback=e.callTimeoutCallback||null;this.logoutCallback=e.logoutCallback||null};Usergrid.Client.prototype.request=function(e,t){var n=this;var r=e.method||"GET";var i=e.endpoint;var s=e.body||{};var o=e.qs||{};var u=e.mQuery||false;if(u){var a=this.URI+"/"+i}else{var a=this.URI+"/"+this.orgName+"/"+this.appName+"/"+i}if(n.getToken()){o["access_token"]=n.getToken()}var f=encodeParams(o);if(f){a+="?"+f}s=JSON.stringify(s);var l=new XMLHttpRequest;l.open(r,a,true);if(s){l.setRequestHeader("Content-Type","application/json")}l.onerror=function(){n._end=(new Date).getTime();if(n.logging){console.log("success (time: "+n.calcTimeDiff()+"): "+r+" "+a)}if(n.logging){console.log("Error: API call failed at the network level.")}clearTimeout(c);var e=true;if(typeof t==="function"){t(e,data)}};l.onload=function(e){n._end=(new Date).getTime();if(n.logging){console.log("success (time: "+n.calcTimeDiff()+"): "+r+" "+a)}clearTimeout(c);e=JSON.parse(l.responseText);if(l.status!=200){var i=e.error;var s=e.error_description;if(n.logging){console.log("Error ("+l.status+")("+i+"): "+s)}if(i=="auth_expired_session_token"||i=="unauthorized"||i=="auth_missing_credentials"||i=="auth_invalid"){if(typeof n.logoutCallback==="function"){return n.logoutCallback(true,e)}}if(typeof t==="function"){t(true,e)}}else{if(typeof t==="function"){t(false,e)}}};var c=setTimeout(function(){l.abort();if(n._callTimeoutCallback==="function"){n._callTimeoutCallback("API CALL TIMEOUT")}else{n.callback("API CALL TIMEOUT")}},n._callTimeout);if(this.logging){console.log("calling: "+r+" "+a)}if(this.buildCurl){var h={uri:a,body:s,method:r};this.buildCurlCall(h)}this._start=(new Date).getTime();l.send(s)};Usergrid.Client.prototype.createEntity=function(e,t){var n=e.getOnExist||false;var e={client:this,data:e};var r=new Usergrid.Entity(e);r.fetch(function(i,s){var o=i&&"service_resource_not_found"===s.error||"no_name_specified"===s.error||!i&&n;if(o){r.set(e.data);r.save(function(e,n){if(typeof t==="function"){t(e,r)}})}else{if(typeof t==="function"){t(i,r)}}})};Usergrid.Client.prototype.getEntity=function(e,t){var e={client:this,data:e};var n=new Usergrid.Entity(e);n.fetch(function(e,r){if(typeof t==="function"){t(e,n)}})};Usergrid.Client.prototype.createCollection=function(e,t){e.client=this;var n=new Usergrid.Collection(e,function(e,r){if(typeof t==="function"){t(e,n)}})};Usergrid.Client.prototype.createUserActivity=function(e,t,n){t.type="users/"+e+"/activities";var t={client:this,data:t};var r=new Usergrid.Entity(t);r.save(function(e,t){if(typeof n==="function"){n(e,r)}})};Usergrid.Client.prototype.calcTimeDiff=function(){var e=0;var t=this._end-this._start;try{e=(t/10/60).toFixed(2)}catch(n){return 0}return e};Usergrid.Client.prototype.setToken=function(e){var t="token"+this.appName+this.orgName;this.token=e;if(typeof Storage!=="undefined"){if(e){localStorage.setItem(t,e)}else{localStorage.removeItem(t)}}};Usergrid.Client.prototype.getToken=function(){var e="token"+this.appName+this.orgName;if(this.token){return this.token}else if(typeof Storage!=="undefined"){return localStorage.getItem(e)}return null};Usergrid.Client.prototype.signup=function(e,t,n,r,i){var s=this;var o={type:"users",username:e,password:t,email:n,name:r};this.createEntity(o,i)};Usergrid.Client.prototype.login=function(e,t,n){var r=this;var i={method:"POST",endpoint:"token",body:{username:e,password:t,grant_type:"password"}};this.request(i,function(e,t){var i={};if(e&&r.logging){console.log("error trying to log user in")}else{i=new Usergrid.Entity("users",t.user);r.setToken(t.access_token)}if(typeof n==="function"){n(e,t,i)}})};Usergrid.Client.prototype.loginFacebook=function(e,t){var n=this;var r={method:"GET",endpoint:"auth/facebook",qs:{fb_access_token:e}};this.request(r,function(e,r){var i={};if(e&&n.logging){console.log("error trying to log user in")}else{i=new Usergrid.Entity("users",r.user);n.setToken(r.access_token)}if(typeof t==="function"){t(e,r,i)}})};Usergrid.Client.prototype.getLoggedInUser=function(e){if(!this.getToken()){e(true,null,null)}else{var t=this;var n={method:"GET",endpoint:"users/me"};this.request(n,function(n,r){if(n){if(t.logging){console.log("error trying to log user in")}if(typeof e==="function"){e(n,r,null)}}else{var i={client:t,data:r.entities[0]};var s=new Usergrid.Entity(i);if(typeof e==="function"){e(n,r,s)}}})}};Usergrid.Client.prototype.isLoggedIn=function(){if(this.getToken()){return true}return false};Usergrid.Client.prototype.logout=function(){this.setToken(null)};Usergrid.Client.prototype.buildCurlCall=function(e){var t="curl";var n=(e.method||"GET").toUpperCase();var r=e.body||{};var i=e.uri;if(n==="POST"){t+=" -X POST"}else if(n==="PUT"){t+=" -X PUT"}else if(n==="DELETE"){t+=" -X DELETE"}else{t+=" -X GET"}t+=" "+i;if(r!=='"{}"'&&n!=="GET"&&n!=="DELETE"){t+=" -d '"+r+"'"}console.log(t);return t};Usergrid.Entity=function(e){this._client=e.client;this._data=e.data||{}};Usergrid.Entity.prototype.get=function(e){if(e){return this._data[e]}else{return this._data}};Usergrid.Entity.prototype.set=function(e,t){if(typeof e==="object"){for(var n in e){this._data[n]=e[n]}}else if(typeof e==="string"){if(t===null){delete this._data[e]}else{this._data[e]=t}}else{this._data=null}};Usergrid.Entity.prototype.save=function(e){var t=this.get("type");var n="POST";if(isUUID(this.get("uuid"))){n="PUT";t+="/"+this.get("uuid")}var r=this;var i={};var s=this.get();for(var o in s){if(o==="metadata"||o==="created"||o==="modified"||o==="type"||o==="activatted"||o==="uuid"){continue}i[o]=s[o]}var u={method:n,endpoint:t,body:i};this._client.request(u,function(n,i){if(n&&r._client.logging){console.log("could not save entity");if(typeof e==="function"){return e(n,i,r)}}else{if(i.entities){if(i.entities.length){var o=i.entities[0];r.set(o)}}var u=r.get("type")==="user"&&s.oldpassword&&s.newpassword;if(u){var a={};a.oldpassword=s.oldpassword;a.newpassword=s.newpassword;var f={method:"PUT",endpoint:t+"/password",body:a};r._client.request(f,function(t,n){if(t&&r._client.logging){console.log("could not update user")}r.set("oldpassword",null);r.set("newpassword",null);if(typeof e==="function"){e(t,n,r)}})}else if(typeof e==="function"){e(n,i,r)}}})};Usergrid.Entity.prototype.fetch=function(e){var t=this.get("type");var n=this;if(this.get("uuid")){t+="/"+this.get("uuid")}else{if(t==="users"){if(this.get("username")){t+="/"+this.get("username")}else{if(typeof e==="function"){var r="no_name_specified";if(n._client.logging){console.log(r)}return e(true,{error:r},n)}}}else{if(this.get("name")){t+="/"+this.get("name")}else{if(typeof e==="function"){var r="no_name_specified";if(n._client.logging){console.log(r)}return e(true,{error:r},n)}}}}var i={method:"GET",endpoint:t};this._client.request(i,function(t,r){if(t&&n._client.logging){console.log("could not get entity")}else{if(r.user){n.set(r.user)}else if(r.entities){if(r.entities.length){var i=r.entities[0];n.set(i)}}}if(typeof e==="function"){e(t,r,n)}})};Usergrid.Entity.prototype.destroy=function(e){var t=this.get("type");if(isUUID(this.get("uuid"))){t+="/"+this.get("uuid")}else{if(typeof e==="function"){var n="Error trying to delete object - no uuid specified.";if(r._client.logging){console.log(n)}e(true,n)}}var r=this;var i={method:"DELETE",endpoint:t};this._client.request(i,function(t,n){if(t&&r._client.logging){console.log("entity could not be deleted")}else{r.set(null)}if(typeof e==="function"){e(t,n)}})};Usergrid.Entity.prototype.connect=function(e,t,n){var r=this;var i=t.get("type");var s=this.getEntityId(t);if(!s){if(typeof n==="function"){var o="Error trying to delete object - no uuid specified.";if(r._client.logging){console.log(o)}n(true,o)}return}var u=this.get("type");var a=this.getEntityId(this);if(!a){if(typeof n==="function"){var o="Error in connect - no uuid specified.";if(r._client.logging){console.log(o)}n(true,o)}return}var f=u+"/"+a+"/"+e+"/"+i+"/"+s;var l={method:"POST",endpoint:f};this._client.request(l,function(e,t){if(e&&r._client.logging){console.log("entity could not be connected")}if(typeof n==="function"){n(e,t)}})};Usergrid.Entity.prototype.getEntityId=function(e){var t=false;if(isUUID(e.get("uuid"))){t=e.get("uuid")}else{if(type==="users"){t=e.get("username")}else if(e.get("name")){t=e.get("name")}}return t};Usergrid.Entity.prototype.getConnections=function(e,t){var n=this;var r=this.get("type");var i=this.getEntityId(this);if(!i){if(typeof t==="function"){var s="Error in getConnections - no uuid specified.";if(n._client.logging){console.log(s)}t(true,s)}return}var o=r+"/"+i+"/"+e+"/";var u={method:"GET",endpoint:o};this._client.request(u,function(r,i){if(r&&n._client.logging){console.log("entity could not be connected")}n[e]={};var s=i.entities.length;for(var o=0;o<s;o++){if(i.entities[o].type==="user"){n[e][i.entities[o].username]=i.entities[o]}else{n[e][i.entities[o].name]=i.entities[o]}}if(typeof t==="function"){t(r,i)}})};Usergrid.Entity.prototype.disconnect=function(e,t,n){var r=this;var i=t.get("type");var s=this.getEntityId(t);if(!s){if(typeof n==="function"){var o="Error trying to delete object - no uuid specified.";if(r._client.logging){console.log(o)}n(true,o)}return}var u=this.get("type");var a=this.getEntityId(this);if(!a){if(typeof n==="function"){var o="Error in connect - no uuid specified.";if(r._client.logging){console.log(o)}n(true,o)}return}var f=u+"/"+a+"/"+e+"/"+i+"/"+s;var l={method:"DELETE",endpoint:f};this._client.request(l,function(e,t){if(e&&r._client.logging){console.log("entity could not be disconnected")}if(typeof n==="function"){n(e,t)}})};Usergrid.Collection=function(e,t){this._client=e.client;this._type=e.type;this.qs=e.qs||{};this._list=[];this._iterator=-1;this._previous=[];this._next=null;this._cursor=null;this.fetch(t)};Usergrid.Collection.prototype.fetch=function(e){var t=this;var n=this.qs;if(this._cursor){n.cursor=this._cursor}else{delete n.cursor}var r={method:"GET",endpoint:this._type,qs:this.qs};this._client.request(r,function(n,r){if(n&&t._client.logging){console.log("error getting collection")}else{var i=r.cursor||null;t.saveCursor(i);if(r.entities){t.resetEntityPointer();var s=r.entities.length;t._list=[];for(var o=0;o<s;o++){var u=r.entities[o].uuid;if(u){var a=r.entities[o]||{};var f={type:t._type,client:t._client,uuid:u,data:a};var l=new Usergrid.Entity(f);var c=t._list.length;t._list[c]=l}}}}if(typeof e==="function"){e(n,r)}})};Usergrid.Collection.prototype.addEntity=function(e,t){var n=this;e.type=this._type;this._client.createEntity(e,function(e,r){if(!e){var i=n._list.length;n._list[i]=r}if(typeof t==="function"){t(e,r)}})};Usergrid.Collection.prototype.destroyEntity=function(e,t){var n=this;e.destroy(function(e,r){if(e){if(n._client.logging){console.log("could not destroy entity")}if(typeof t==="function"){t(e,r)}}else{n.fetch(t)}})};Usergrid.Collection.prototype.getEntityByUUID=function(e,t){var n={data:{type:this._type,uuid:e},client:this._client};var r=new Usergrid.Entity(n);r.fetch(t)};Usergrid.Collection.prototype.getFirstEntity=function(){var e=this._list.length;if(e>0){return this._list[0]}return null};Usergrid.Collection.prototype.getLastEntity=function(){var e=this._list.length;if(e>0){return this._list[e-1]}return null};Usergrid.Collection.prototype.hasNextEntity=function(){var e=this._iterator+1;var t=e>=0&&e<this._list.length;if(t){return true}return false};Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;var e=this._iterator>=0&&this._iterator<=this._list.length;if(e){return this._list[this._iterator]}return false};Usergrid.Collection.prototype.hasPrevEntity=function(){var e=this._iterator-1;var t=e>=0&&e<this._list.length;if(t){return true}return false};Usergrid.Collection.prototype.getPrevEntity=function(){this._iterator--;var e=this._iterator>=0&&this._iterator<=this._list.length;if(e){return this.list[this._iterator]}return false};Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1};Usergrid.Collection.prototype.saveCursor=function(e){if(this._next!==e){this._next=e}};Usergrid.Collection.prototype.resetPaging=function(){this._previous=[];this._next=null;this._cursor=null};Usergrid.Collection.prototype.hasNextPage=function(){return this._next};Usergrid.Collection.prototype.getNextPage=function(e){if(this.hasNextPage()){this._previous.push(this._cursor);this._cursor=this._next;this._list=[];this.fetch(e)}};Usergrid.Collection.prototype.hasPreviousPage=function(){return this._previous.length>0};Usergrid.Collection.prototype.getPreviousPage=function(e){if(this.hasPreviousPage()){this._next=null;this._cursor=this._previous.pop();this._list=[];this.fetch(e)}}