window.console=window.console||{};window.console.log=window.console.log||function(){};window.Usergrid=window.Usergrid||{};Usergrid=Usergrid||{};Usergrid.SDK_VERSION="0.9.10";(function(){Usergrid.Query=function(f,b,e,c,a,d){this._method=f;this._resource=b;this._jsonObj=e;this._paramsObj=c;this._successCallback=a;this._failureCallback=d;this._curl="";this._token=false;this._cursor=null;this._next=null;this._previous=[];this._start=0;this._end=0};Usergrid.Query.prototype={setQueryStartTime:function(){this._start=new Date().getTime()},setQueryEndTime:function(){this._end=new Date().getTime()},getQueryTotalTime:function(){var c=0;var b=this._end-this._start;try{c=((b/10)/60).toFixed(2)}catch(a){return 0}return this.getMethod()+" "+this.getResource()+" - "+c+" seconds"},setAllQueryParams:function(f,b,e,c,a,d){this._method=f;this._resource=b;this._jsonObj=e;this._paramsObj=c;this._successCallback=a;this._failureCallback=d},clearAll:function(){this._method=null;this._resource=null;this._jsonObj={};this._paramsObj={};this._successCallback=null;this._failureCallback=null},getMethod:function(){return this._method},setMethod:function(a){this._method=a},getResource:function(){return this._resource},setResource:function(a){this._resource=a},getJsonObj:function(){return this._jsonObj},setJsonObj:function(a){this._jsonObj=a},getQueryParams:function(){return this._paramsObj},setQueryParams:function(a){this._paramsObj=a},getSuccessCallback:function(){return this._successCallback},setSuccessCallback:function(a){this._successCallback=a},callSuccessCallback:function(a){if(this._successCallback&&typeof(this._successCallback)==="function"){this._successCallback(a);return true}else{return false}},getFailureCallback:function(){return this._failureCallback},setFailureCallback:function(a){this._failureCallback=a},callFailureCallback:function(a){if(this._failureCallback&&typeof(this._failureCallback)==="function"){this._failureCallback(a);return true}else{return false}},getCurl:function(){return this._curl},setCurl:function(a){this._curl=a},getToken:function(){return this._token},setToken:function(a){this._token=a},resetPaging:function(){this._previous=[];this._next=null;this._cursor=null},hasPrevious:function(){return(this._previous.length>0)},getPrevious:function(){this._next=null;this._cursor=this._previous.pop()},hasNext:function(){return(this._next)},getNext:function(){this._previous.push(this._cursor);this._cursor=this._next},saveCursor:function(a){if(this._next!==a){this._next=a}},getCursor:function(){return this._cursor},isUUID:function(a){var b=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;if(!a){return false}return b.test(a)}}})(Usergrid);Usergrid.M="ManagementQuery";Usergrid.A="ApplicationQuery";Usergrid.ApiClient=(function(){var u="https://api.usergrid.com/";var t=null;var O=null;var o=null;var D=30000;var K=null;var z=null;var w=null;var e=null;function L(Q,P){this.setOrganizationName(Q);this.setApplicationName(P)}function E(P){var Q="/"+this.getOrganizationName()+"/"+this.getApplicationName()+"/";x(Usergrid.A);r(P,Q)}function k(P){var Q="/management/";x(Usergrid.M);r(P,Q)}function n(){return t}function m(P){t=P}function C(){return O}function a(P){O=P}function l(){return o}function f(P){o=P}function N(){return u}function b(P){u=P}function c(){return D}function I(P){D=P}function q(P){e=P}function y(){return e}function B(P){if(e&&typeof(e)==="function"){e(P);return true}else{return false}}function g(){return N()+"/management/users/resetpw"}function G(){return this._loggedInUser}function d(P){this._loggedInUser=P}function s(U,R,P,T){var Q=this;var S={username:U,password:R,grant_type:"password"};this.runAppQuery(new Usergrid.Query("GET","token",null,S,function(W){var V=new Usergrid.Entity("users");V.set("username",W.user.username);V.set("name",W.user.name);V.set("email",W.user.email);V.set("uuid",W.user.uuid);Q.setLoggedInUser(V);Q.setToken(W.access_token);if(P&&typeof(P)==="function"){P(W)}},function(V){if(T&&typeof(T)==="function"){T(V)}}))}function J(){}function h(){this.setLoggedInUser(null);this.setToken(null)}function A(){var P=this.getLoggedInUser();return(this.getToken()&&P.get("uuid"))}function p(){return w}function F(P){w=P}function H(){if(w&&typeof(w)==="function"){w();return true}else{return false}}function M(S){tail=[];var Q=[];if(S instanceof Array){for(i in S){Q=S[i];if((Q instanceof Array)&&(Q.length>1)){tail.push(Q[0]+"="+encodeURIComponent(Q[1]))}}}else{for(var P in S){if(S.hasOwnProperty(P)){var R=S[P];if(R instanceof Array){for(i in R){Q=R[i];tail.push(P+"="+encodeURIComponent(Q))}}else{tail.push(P+"="+encodeURIComponent(R))}}}}return tail.join("&")}function j(){return K}function x(P){K=P}function r(T,Y){try{if(!(T instanceof Usergrid.Query)){throw (new Error("Query is not a valid object."))}T.setQueryStartTime();var P=T.getMethod().toUpperCase();var aa=T.getResource();var X=T.getJsonObj()||{};var R=T.getQueryParams()||{};if(P!="GET"&&P!="POST"&&P!="PUT"&&P!="DELETE"){throw (new Error("Invalid method - should be GET, POST, PUT, or DELETE."))}var S=Usergrid.ApiClient.getApplicationName();if(S){S=S.toUpperCase()}if((S!="SANDBOX"&&Usergrid.ApiClient.getToken())||(j()==Usergrid.M&&Usergrid.ApiClient.getToken())){T.setToken(true)}_params=JSON.stringify(R);if(!JSON.parse(_params)){throw (new Error("Params object is not valid."))}if(T.getCursor()){R.cursor=T.getCursor()}else{delete R.cursor}Y=Y.indexOf("/")==0?Y.substring(1):Y;aa=Y+aa;if(aa){while(aa.indexOf("//")!=-1){aa=aa.replace("//","/")}}aa=Usergrid.ApiClient.getApiUrl()+aa;if((P=="GET")||(P=="DELETE")){R._=new Date().getTime()}var Z=M(R);if(Z){aa+="?"+Z}X=JSON.stringify(X);if(!JSON.parse(X)){throw (new Error("JSON object is not valid."))}if(X=="{}"){X=null}}catch(U){console.log("error occured running query -"+U.message);return false}try{curl=Usergrid.Curl.buildCurlCall(T,Y);console.log(curl);T.setCurl(curl)}catch(U){}var Q=window.XDomainRequest?true:false;var W=v(P,aa,X);W.onerror=function(){T.setQueryEndTime();console.log(T.getQueryTotalTime());clearTimeout(V);console.log("API call failed at the network level.");T.callFailureCallback(response.innerText)};W.xdomainOnload=function(ab){T.setQueryEndTime();console.log("Call timing: "+T.getQueryTotalTime());clearTimeout(V);ab=JSON.parse(W.responseText);try{var ad=ab.cursor||null;T.saveCursor(ad)}catch(ac){}T.callSuccessCallback(ab)};W.onload=function(ab){T.setQueryEndTime();console.log("Call timing: "+T.getQueryTotalTime());clearTimeout(V);ab=JSON.parse(W.responseText);if(W.status!=200&&!Q){try{var ac=ab.error;console.log("API call failed: (status: "+W.status+")."+ac.type);if((ac.type=="auth_expired_session_token")||(ac.type=="unauthorized")||(ac.type=="auth_missing_credentials")||(ac.type=="auth_invalid")){H()}}catch(ad){}T.callFailureCallback(ab.error_description);return}else{var ae=ab.cursor||null;T.saveCursor(ae);T.callSuccessCallback(ab)}};var V=setTimeout(function(){W.abort();if(Usergrid.ApiClient.getCallTimeoutCallback()==="function"){Usergrid.ApiClient.callTimeoutCallback("API CALL TIMEOUT")}else{T.callFailureCallback("API CALL TIMEOUT")}},Usergrid.ApiClient.getCallTimeout());W.send(X)}function v(S,P,R){var Q;if(window.XDomainRequest){Q=new window.XDomainRequest();if(Usergrid.ApiClient.getToken()){if(P.indexOf("?")){P+="&access_token="+Usergrid.ApiClient.getToken()}else{P="?access_token="+Usergrid.ApiClient.getToken()}}Q.open(S,P,true)}else{Q=new XMLHttpRequest();Q.open(S,P,true);if(R){Q.setRequestHeader("Content-Type","application/json")}if(Usergrid.ApiClient.getToken()){Q.setRequestHeader("Authorization","Bearer "+Usergrid.ApiClient.getToken());Q.withCredentials=true}}return Q}return{init:L,runAppQuery:E,runManagementQuery:k,getOrganizationName:n,setOrganizationName:m,getApplicationName:C,setApplicationName:a,getToken:l,setToken:f,getQueryType:j,getCallTimeout:c,setCallTimeout:I,getCallTimeoutCallback:y,setCallTimeoutCallback:q,callTimeoutCallback:B,getApiUrl:N,setApiUrl:b,getResetPasswordUrl:g,getLoggedInUser:G,setLoggedInUser:d,logInAppUser:s,renewAppUserToken:J,logoutAppUser:h,encodeParams:M,isLoggedInAppUser:A,getLogoutCallback:p,setLogoutCallback:F,callLogoutCallback:H}})();