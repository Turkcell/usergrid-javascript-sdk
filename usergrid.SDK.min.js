window.console=window.console||{};window.console.log=window.console.log||function(){};window.Usergrid=window.Usergrid||{};Usergrid=Usergrid||{};Usergrid.SDK_VERSION="0.9.10";(function(){Usergrid.Query=function(f,b,e,c,a,d){this._method=f;this._resource=b;this._jsonObj=e;this._paramsObj=c;this._successCallback=a;this._failureCallback=d;this._curl="";this._token=false;this._cursor=null;this._next=null;this._previous=[];this._start=0;this._end=0};Usergrid.Query.prototype={setQueryStartTime:function(){this._start=new Date().getTime()},setQueryEndTime:function(){this._end=new Date().getTime()},getQueryTotalTime:function(){var c=0;var b=this._end-this._start;try{c=((b/10)/60).toFixed(2)}catch(a){return 0}return this.getMethod()+" "+this.getResource()+" - "+c+" seconds"},setAllQueryParams:function(f,b,e,c,a,d){this._method=f;this._resource=b;this._jsonObj=e;this._paramsObj=c;this._successCallback=a;this._failureCallback=d},clearAll:function(){this._method=null;this._resource=null;this._jsonObj={};this._paramsObj={};this._successCallback=null;this._failureCallback=null},getMethod:function(){return this._method},setMethod:function(a){this._method=a},getResource:function(){return this._resource},setResource:function(a){this._resource=a},getJsonObj:function(){return this._jsonObj},setJsonObj:function(a){this._jsonObj=a},getQueryParams:function(){return this._paramsObj},setQueryParams:function(a){this._paramsObj=a},getSuccessCallback:function(){return this._successCallback},setSuccessCallback:function(a){this._successCallback=a},callSuccessCallback:function(a){if(this._successCallback&&typeof(this._successCallback)==="function"){this._successCallback(a);return true}else{return false}},getFailureCallback:function(){return this._failureCallback},setFailureCallback:function(a){this._failureCallback=a},callFailureCallback:function(a){if(this._failureCallback&&typeof(this._failureCallback)==="function"){this._failureCallback(a);return true}else{return false}},getCurl:function(){return this._curl},setCurl:function(a){this._curl=a},getToken:function(){return this._token},setToken:function(a){this._token=a},resetPaging:function(){this._previous=[];this._next=null;this._cursor=null},hasPrevious:function(){return(this._previous.length>0)},getPrevious:function(){this._next=null;this._cursor=this._previous.pop()},hasNext:function(){return(this._next)},getNext:function(){this._previous.push(this._cursor);this._cursor=this._next},saveCursor:function(a){if(this._next!==a){this._next=a}},getCursor:function(){return this._cursor},isUUID:function(a){var b=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;if(!a){return false}return b.test(a)}}})(Usergrid);Usergrid.M="ManagementQuery";Usergrid.A="ApplicationQuery";Usergrid.ApiClient=(function(){var w="https://api.usergrid.com/";var v=null;var Q=null;var o=null;var F=30000;var M=null;var B=null;var y=null;var e=null;function u(R){if(R.orgName){this.setOrganizationName(R.orgName)}if(R.appName){this.setApplicationName(R.appName)}if(R.timeoutValue){this.setCallTimeout(R.timeoutValue)}}function N(S,R){this.setOrganizationName(S);this.setApplicationName(R)}function G(R){var S="/"+this.getOrganizationName()+"/"+this.getApplicationName()+"/";z(Usergrid.A);r(R,S)}function k(R){var S="/management/";z(Usergrid.M);r(R,S)}function n(){return v}function m(R){v=R}function E(){return Q}function a(R){Q=R}function l(){return o}function f(R){o=R}function P(){return w}function b(R){w=R}function c(){return F}function K(R){F=R}function q(R){e=R}function A(){return e}function D(R){if(e&&typeof(e)==="function"){e(R);return true}else{return false}}function g(){return P()+"/management/users/resetpw"}function I(){return this._loggedInUser}function d(R){this._loggedInUser=R}function t(W,T,R,V){var S=this;var U={username:W,password:T,grant_type:"password"};this.runAppQuery(new Usergrid.Query("GET","token",null,U,function(Y){var X=new Usergrid.Entity("users");X.set("username",Y.user.username);X.set("name",Y.user.name);X.set("email",Y.user.email);X.set("uuid",Y.user.uuid);S.setLoggedInUser(X);S.setToken(Y.access_token);if(R&&typeof(R)==="function"){R(Y)}},function(X){if(V&&typeof(V)==="function"){V(X)}}))}function s(S,R,V){var T=this;var U={fb_access_token:S};this.runAppQuery(new Usergrid.Query("GET","auth/facebook",null,U,function(X){var W=new Usergrid.Entity("users");W.set("username",X.user.username);W.set("name",X.user.name);W.set("email",X.user.email);W.set("uuid",X.user.uuid);T.setLoggedInUser(W);T.setToken(X.access_token);if(R&&typeof(R)==="function"){R(X)}},function(W){if(V&&typeof(V)==="function"){V(W)}}))}function L(){}function h(){this.setLoggedInUser(null);this.setToken(null)}function C(){var R=this.getLoggedInUser();return(this.getToken()&&R.get("uuid"))}function p(){return y}function H(R){y=R}function J(){if(y&&typeof(y)==="function"){y();return true}else{return false}}function O(U){tail=[];var S=[];if(U instanceof Array){for(i in U){S=U[i];if((S instanceof Array)&&(S.length>1)){tail.push(S[0]+"="+encodeURIComponent(S[1]))}}}else{for(var R in U){if(U.hasOwnProperty(R)){var T=U[R];if(T instanceof Array){for(i in T){S=T[i];tail.push(R+"="+encodeURIComponent(S))}}else{tail.push(R+"="+encodeURIComponent(T))}}}}return tail.join("&")}function j(){return M}function z(R){M=R}function r(V,aa){try{if(!(V instanceof Usergrid.Query)){throw (new Error("Query is not a valid object."))}V.setQueryStartTime();var R=V.getMethod().toUpperCase();var ac=V.getResource();var Z=V.getJsonObj()||{};var T=V.getQueryParams()||{};if(R!="GET"&&R!="POST"&&R!="PUT"&&R!="DELETE"){throw (new Error("Invalid method - should be GET, POST, PUT, or DELETE."))}var U=Usergrid.ApiClient.getApplicationName();if(U){U=U.toUpperCase()}if((U!="SANDBOX"&&Usergrid.ApiClient.getToken())||(j()==Usergrid.M&&Usergrid.ApiClient.getToken())){V.setToken(true)}_params=JSON.stringify(T);if(!JSON.parse(_params)){throw (new Error("Params object is not valid."))}if(V.getCursor()){T.cursor=V.getCursor()}else{delete T.cursor}aa=aa.indexOf("/")==0?aa.substring(1):aa;ac=aa+ac;if(ac){while(ac.indexOf("//")!=-1){ac=ac.replace("//","/")}}ac=Usergrid.ApiClient.getApiUrl()+ac;if((R=="GET")||(R=="DELETE")){T._=new Date().getTime()}var ab=O(T);if(ab){ac+="?"+ab}Z=JSON.stringify(Z);if(!JSON.parse(Z)){throw (new Error("JSON object is not valid."))}if(Z=="{}"){Z=null}}catch(W){console.log("error occured running query -"+W.message);return false}try{curl=Usergrid.Curl.buildCurlCall(V,aa);console.log(curl);V.setCurl(curl)}catch(W){}var S=window.XDomainRequest?true:false;var Y=x(R,ac,Z);Y.onerror=function(){V.setQueryEndTime();console.log(V.getQueryTotalTime());clearTimeout(X);console.log("API call failed at the network level.");V.callFailureCallback(response.innerText)};Y.xdomainOnload=function(ad){V.setQueryEndTime();console.log("Call timing: "+V.getQueryTotalTime());clearTimeout(X);ad=JSON.parse(Y.responseText);try{var af=ad.cursor||null;V.saveCursor(af)}catch(ae){}V.callSuccessCallback(ad)};Y.onload=function(ad){V.setQueryEndTime();console.log("Call timing: "+V.getQueryTotalTime());clearTimeout(X);ad=JSON.parse(Y.responseText);if(Y.status!=200&&!S){try{var ae=ad.error;console.log("API call failed: (status: "+Y.status+")."+ae.type);if((ae.type=="auth_expired_session_token")||(ae.type=="unauthorized")||(ae.type=="auth_missing_credentials")||(ae.type=="auth_invalid")){J()}}catch(af){}V.callFailureCallback(ad.error_description);return}else{var ag=ad.cursor||null;V.saveCursor(ag);V.callSuccessCallback(ad)}};var X=setTimeout(function(){Y.abort();if(Usergrid.ApiClient.getCallTimeoutCallback()==="function"){Usergrid.ApiClient.callTimeoutCallback("API CALL TIMEOUT")}else{V.callFailureCallback("API CALL TIMEOUT")}},Usergrid.ApiClient.getCallTimeout());Y.send(Z)}function x(U,R,T){var S;if(window.XDomainRequest){S=new window.XDomainRequest();if(Usergrid.ApiClient.getToken()){if(R.indexOf("?")){R+="&access_token="+Usergrid.ApiClient.getToken()}else{R="?access_token="+Usergrid.ApiClient.getToken()}}S.open(U,R,true)}else{S=new XMLHttpRequest();S.open(U,R,true);if(T){S.setRequestHeader("Content-Type","application/json")}if(Usergrid.ApiClient.getToken()){S.setRequestHeader("Authorization","Bearer "+Usergrid.ApiClient.getToken());S.withCredentials=true}}return S}return{init:N,runAppQuery:G,runManagementQuery:k,getOrganizationName:n,setOrganizationName:m,getApplicationName:E,setApplicationName:a,getToken:l,setToken:f,getQueryType:j,getCallTimeout:c,setCallTimeout:K,getCallTimeoutCallback:A,setCallTimeoutCallback:q,callTimeoutCallback:D,getApiUrl:P,setApiUrl:b,getResetPasswordUrl:g,getLoggedInUser:I,setLoggedInUser:d,logInAppUser:t,logInWithFacebook:s,renewAppUserToken:L,logoutAppUser:h,encodeParams:O,isLoggedInAppUser:C,getLogoutCallback:p,setLogoutCallback:H,callLogoutCallback:J}})();(function(){Usergrid.Entity=function(b,a){this._collectionType=b;this._data={};if(a){this._data.uuid=a}};Usergrid.Entity.prototype=new Usergrid.Query();Usergrid.Entity.prototype.getCollectionType=function(){return this._collectionType};Usergrid.Entity.prototype.setCollectionType=function(a){this._collectionType=a};Usergrid.Entity.prototype.get=function(a){if(a){return this._data[a]}else{return this._data}},Usergrid.Entity.prototype.set=function(a,b){if(typeof a==="object"){for(var c in a){this._data[c]=a[c]}}else{if(typeof a==="string"){if(b===null){delete this._data[a]}else{this._data[a]=b}}else{this._data=null}}};Usergrid.Entity.prototype.save=function(c,f){var j=this.getCollectionType();var a="POST";if(this.isUUID(this.get("uuid"))){a="PUT";j+="/"+this.get("uuid")}var d={};if(j=="users"){d=this.get();var e={};if(d.oldpassword&&d.newpassword){e.oldpassword=d.oldpassword;e.newpassword=d.newpassword;this.runAppQuery(new Usergrid.Query("PUT","users/"+uuid+"/password",e,null,function(k){},function(k){}))}delete d.oldpassword;delete d.newpassword}var h=this;d={};var b=this.get();for(var g in b){if(g=="metadata"||g=="created"||g=="modified"||g=="type"||g=="activatted"){continue}d[g]=b[g]}this.setAllQueryParams(a,j,d,null,function(l){try{var k=l.entities[0];h.set(k);if(typeof(c)==="function"){c(l)}}catch(m){if(typeof(f)==="function"){f(l)}}},function(k){if(typeof(f)==="function"){f(k)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Entity.prototype.fetch=function(a,c){var d=this.getCollectionType();if(this.isUUID(this.get("uuid"))){d+="/"+this.get("uuid")}else{if(d=="users"){if(this.get("username")){d+="/"+this.get("username")}else{console.log("no username specified");if(typeof(c)==="function"){console.log("no username specified")}}}else{if(this.get()){d+="/"+this.get()}else{console.log("no entity identifier specified");if(typeof(c)==="function"){console.log("no entity identifier specified")}}}}var b=this;this.setAllQueryParams("GET",d,null,null,function(e){if(e.user){b.set(e.user)}else{if(e.entities[0]){b.set(e.entities[0])}}if(typeof(a)==="function"){a(e)}},function(e){if(typeof(c)==="function"){c(e)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Entity.prototype.destroy=function(a,c){var d=this.getCollectionType();if(this.isUUID(this.get("uuid"))){d+="/"+this.get("uuid")}else{console.log("Error trying to delete object - no uuid specified.");if(typeof(c)==="function"){c("Error trying to delete object - no uuid specified.")}}var b=this;this.setAllQueryParams("DELETE",d,null,null,function(e){b.set(null);if(typeof(a)==="function"){a(e)}},function(e){if(typeof(c)==="function"){c(e)}});Usergrid.ApiClient.runAppQuery(this)}})(Usergrid);(function(){Usergrid.Collection=function(b,a){this._path=b;this._uuid=a;this._list=[];this._Query=new Usergrid.Query();this._iterator=-1};Usergrid.Collection.prototype=new Usergrid.Query();Usergrid.Collection.prototype.getPath=function(){return this._path};Usergrid.Collection.prototype.setPath=function(a){this._path=a};Usergrid.Collection.prototype.getUUID=function(){return this._uuid};Usergrid.Collection.prototype.setUUID=function(a){this._uuid=a};Usergrid.Collection.prototype.addEntity=function(a){var b=this._list.length;this._list[b]=a};Usergrid.Collection.prototype.addNewEntity=function(c,a,b){this.addEntity(c);c.save(a,b)};Usergrid.Collection.prototype.destroyEntity=function(a){var d=a.get("uuid");if(d){var e=this._list.length;var c=0;var b=false;for(c=0;c<e;c++){if(b){this._list[c-1]=this._list[c];this._list[c]=null}if(this._list[c].get("uuid")==d){this._list[c]=null;b=true}}}a.destroy()};Usergrid.Collection.prototype.getEntityByField=function(d,c){var b=this._list.length;var a=0;for(a=0;a<b;a++){if(this._list[a].getField(d)==c){return this._list[a]}}return null};Usergrid.Collection.prototype.getEntityByUUID=function(c){var b=this._list.length;var a=0;for(a=0;a<b;a++){if(this._list[a].get("uuid")==c){return this._list[a]}}return null};Usergrid.Collection.prototype.getFirstEntity=function(){var a=this._list.length;if(a>0){return this._list[0]}return null};Usergrid.Collection.prototype.getLastEntity=function(){var a=this._list.length;if(a>0){return this._list[a-1]}return null};Usergrid.Collection.prototype.hasNextEntity=function(){var a=this._iterator+1;if(a>=0&&a<this._list.length){return true}return false};Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;if(this._iterator>=0&&this._iterator<=this._list.length){return this._list[this._iterator]}return false};Usergrid.Collection.prototype.hasPreviousEntity=function(){var a=this._iterator-1;if(a>=0&&a<this._list.length){return true}return false};Usergrid.Collection.prototype.getPreviousEntity=function(){this._iterator--;if(this._iterator>=0&&this._iterator<=this._list.length){return this.list[this._iterator]}return false};Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1};Usergrid.Collection.prototype.getEntityList=function(){return this._list};Usergrid.Collection.prototype.setEntityList=function(a){this._list=a};Usergrid.Collection.prototype.hasNextPage=function(){return this.hasNext()};Usergrid.Collection.prototype.getNextPage=function(){if(this.hasNext()){this.getNext();this.setEntityList([]);Usergrid.ApiClient.runAppQuery(this)}};Usergrid.Collection.prototype.hasPreviousPage=function(){return this.hasPrevious()};Usergrid.Collection.prototype.getPreviousPage=function(){if(this.hasPrevious()){this.getPrevious();this.setEntityList([]);Usergrid.ApiClient.runAppQuery(this)}};Usergrid.Collection.prototype.clearQuery=function(){this.clearAll()};Usergrid.Collection.prototype.fetch=function(a,c){var b=this;var d=this.getQueryParams();this.setEntityList([]);this.setAllQueryParams("GET",this.getPath(),null,d,function(f){if(f.entities){this.resetEntityPointer();var j=f.entities.length;for(var g=0;g<j;g++){var h=f.entities[g].uuid;if(h){var e=new Usergrid.Entity(b.getPath(),h);var k=f.entities[g]||{};delete k.uuid;e.set(k);b.addEntity(e)}}if(typeof(a)==="function"){a(f)}}else{if(typeof(c)==="function"){c(f)}}},function(e){if(typeof(c)==="function"){c(e)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Collection.prototype.save=function(a,b){var e=this.getEntityList();var d=e.length;var f=[];for(var c=0;c<d;c++){entity=e[c];data=entity.get();if(entity.get("uuid")){data.uuid=entity.get("uuid");f.push(data)}entity.save()}this.setAllQueryParams("PUT",this.getPath(),f,null,a,b);Usergrid.ApiClient.runAppQuery(this)}})(Usergrid);