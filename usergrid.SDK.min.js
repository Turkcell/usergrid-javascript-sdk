window.console=window.console||{};window.console.log=window.console.log||function(){};window.Usergrid=window.Usergrid||{};Usergrid=Usergrid||{};Usergrid.SDK_VERSION="0.9.9";(function(){Usergrid.Query=function(f,b,e,c,a,d){this._method=f;this._resource=b;this._jsonObj=e;this._paramsObj=c;this._successCallback=a;this._failureCallback=d;this._curl="";this._token=false;this._cursor=null;this._next=null;this._previous=[];this._start=0;this._end=0};Usergrid.Query.prototype={setQueryStartTime:function(){this._start=new Date().getTime()},setQueryEndTime:function(){this._end=new Date().getTime()},getQueryTotalTime:function(){var c=0;var b=this._end-this._start;try{c=((b/10)/60).toFixed(2)}catch(a){return 0}return this.getMethod()+" "+this.getResource()+" - "+c+" seconds"},setAllQueryParams:function(f,b,e,c,a,d){this._method=f;this._resource=b;this._jsonObj=e;this._paramsObj=c;this._successCallback=a;this._failureCallback=d},clearAll:function(){this._method=null;this._resource=null;this._jsonObj={};this._paramsObj={};this._successCallback=null;this._failureCallback=null},getMethod:function(){return this._method},setMethod:function(a){this._method=a},getResource:function(){return this._resource},setResource:function(a){this._resource=a},getJsonObj:function(){return this._jsonObj},setJsonObj:function(a){this._jsonObj=a},getQueryParams:function(){return this._paramsObj},setQueryParams:function(a){this._paramsObj=a},getSuccessCallback:function(){return this._successCallback},setSuccessCallback:function(a){this._successCallback=a},callSuccessCallback:function(a){if(this._successCallback&&typeof(this._successCallback)==="function"){this._successCallback(a);return true}else{return false}},getFailureCallback:function(){return this._failureCallback},setFailureCallback:function(a){this._failureCallback=a},callFailureCallback:function(a){if(this._failureCallback&&typeof(this._failureCallback)==="function"){this._failureCallback(a);return true}else{return false}},getCurl:function(){return this._curl},setCurl:function(a){this._curl=a},getToken:function(){return this._token},setToken:function(a){this._token=a},resetPaging:function(){this._previous=[];this._next=null;this._cursor=null},hasPrevious:function(){return(this._previous.length>0)},getPrevious:function(){this._next=null;this._cursor=this._previous.pop()},hasNext:function(){return(this._next)},getNext:function(){this._previous.push(this._cursor);this._cursor=this._next},saveCursor:function(a){if(this._next!==a){this._next=a}},getCursor:function(){return this._cursor}}})(Usergrid);(function(){Usergrid.Entity=function(b,a){this._collectionType=b;this._data={};if(a){this._data.uuid=a}};Usergrid.Entity.prototype=new Usergrid.Query();Usergrid.Entity.prototype.getCollectionType=function(){return this._collectionType};Usergrid.Entity.prototype.setCollectionType=function(a){this._collectionType=a};Usergrid.Entity.prototype.get=function(a){if(a){return this._data[a]}else{return this._data}},Usergrid.Entity.prototype.set=function(a,b){if(typeof a==="object"){for(var c in a){this._data[c]=a[c]}}else{if(typeof a==="string"){if(b===null){delete this._data[a]}else{this._data[a]=b}}else{this._data=null}}};Usergrid.Entity.prototype.save=function(c,f){var j=this.getCollectionType();var a="POST";if(this.get("uuid")){a="PUT";if(Usergrid.validation.isUUID(this.get("uuid"))){j+="/"+this.get("uuid")}}var d={};if(j=="users"){d=this.get();var e={};if(d.oldpassword&&d.newpassword){e.oldpassword=d.oldpassword;e.newpassword=d.newpassword;this.runAppQuery(new Usergrid.Query("PUT","users/"+uuid+"/password",e,null,function(k){},function(k){}))}delete d.oldpassword;delete d.newpassword}var h=this;d={};var b=this.get();for(var g in b){if(g=="metadata"||g=="created"||g=="modified"||g=="type"||g=="activatted"){continue}d[g]=b[g]}this.setAllQueryParams(a,j,d,null,function(l){try{var k=l.entities[0];h.set(k);if(typeof(c)==="function"){c(l)}}catch(m){if(typeof(f)==="function"){f(l)}}},function(k){if(typeof(f)==="function"){f(k)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Entity.prototype.fetch=function(a,c){var d=this.getCollectionType();if(this.get("uuid")){d+="/"+this.get("uuid")}else{if(d=="users"){if(this.get("username")){d+="/"+this.get("username")}else{console.log("no username specified");if(typeof(c)==="function"){console.log("no username specified")}}}else{if(this.get()){d+="/"+this.get()}else{console.log("no entity identifier specified");if(typeof(c)==="function"){console.log("no entity identifier specified")}}}}var b=this;this.setAllQueryParams("GET",d,null,null,function(g){try{if(g.user){b.set(g.user)}var f=g.entities[0];b.set(f);if(typeof(a)==="function"){a(g)}}catch(h){if(typeof(c)==="function"){c(g)}}},function(e){if(typeof(c)==="function"){c(e)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Entity.prototype.destroy=function(a,c){var d=this.getCollectionType();if(this.get("uuid")){d+="/"+this.get("uuid")}else{console.log("Error trying to delete object - no uuid specified.");if(typeof(c)==="function"){c("Error trying to delete object - no uuid specified.")}}var b=this;this.setAllQueryParams("DELETE",d,null,null,function(e){b.set(null);if(typeof(a)==="function"){a(e)}},function(e){if(typeof(c)==="function"){c(e)}});Usergrid.ApiClient.runAppQuery(this)}})(Usergrid);(function(){Usergrid.Collection=function(b,a){this._path=b;this._uuid=a;this._list=[];this._Query=new Usergrid.Query();this._iterator=-1};Usergrid.Collection.prototype=new Usergrid.Query();Usergrid.Collection.prototype.getPath=function(){return this._path};Usergrid.Collection.prototype.setPath=function(a){this._path=a};Usergrid.Collection.prototype.getUUID=function(){return this._uuid};Usergrid.Collection.prototype.setUUID=function(a){this._uuid=a};Usergrid.Collection.prototype.addEntity=function(a){var b=this._list.length;this._list[b]=a};Usergrid.Collection.prototype.addNewEntity=function(c,a,b){this.addEntity(c);c.save(a,b)};Usergrid.Collection.prototype.destroyEntity=function(a){var d=a.get("uuid");if(Usergrid.validation.isUUID(d)){var e=this._list.length;var c=0;var b=false;for(c=0;c<e;c++){if(b){this._list[c-1]=this._list[c];this._list[c]=null}if(this._list[c].get("uuid")==d){this._list[c]=null;b=true}}}a.destroy()};Usergrid.Collection.prototype.getEntityByField=function(d,c){var b=this._list.length;var a=0;for(a=0;a<b;a++){if(this._list[a].getField(d)==c){return this._list[a]}}return null};Usergrid.Collection.prototype.getEntityByUUID=function(c){var b=this._list.length;var a=0;for(a=0;a<b;a++){if(this._list[a].get("uuid")==c){return this._list[a]}}return null};Usergrid.Collection.prototype.getFirstEntity=function(){var a=this._list.length;if(a>0){return this._list[0]}return null};Usergrid.Collection.prototype.getLastEntity=function(){var a=this._list.length;if(a>0){return this._list[a-1]}return null};Usergrid.Collection.prototype.hasNextEntity=function(){var a=this._iterator+1;if(a>=0&&a<this._list.length){return true}return false};Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;if(this._iterator>=0&&this._iterator<=this._list.length){return this._list[this._iterator]}return false};Usergrid.Collection.prototype.hasPreviousEntity=function(){var a=this._iterator-1;if(a>=0&&a<this._list.length){return true}return false};Usergrid.Collection.prototype.getPreviousEntity=function(){this._iterator--;if(this._iterator>=0&&this._iterator<=this._list.length){return this.list[this._iterator]}return false};Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1};Usergrid.Collection.prototype.getEntityList=function(){return this._list};Usergrid.Collection.prototype.setEntityList=function(a){this._list=a};Usergrid.Collection.prototype.hasNextPage=function(){return this.hasNext()};Usergrid.Collection.prototype.getNextPage=function(){if(this.hasNext()){this.getNext();this.setEntityList([]);Usergrid.ApiClient.runAppQuery(this)}};Usergrid.Collection.prototype.hasPreviousPage=function(){return this.hasPrevious()};Usergrid.Collection.prototype.getPreviousPage=function(){if(this.hasPrevious()){this.getPrevious();this.setEntityList([]);Usergrid.ApiClient.runAppQuery(this)}};Usergrid.Collection.prototype.clearQuery=function(){this.clearAll()};Usergrid.Collection.prototype.get=function(a,b){Usergrid.Collection.fetch(a,b)};Usergrid.Collection.prototype.fetch=function(a,c){var b=this;var d=this.getQueryParams();this.setEntityList([]);this.setAllQueryParams("GET",this.getPath(),null,d,function(f){if(f.entities){this.resetEntityPointer();var j=f.entities.length;for(var g=0;g<j;g++){var h=f.entities[g].uuid;if(h){var e=new Usergrid.Entity(b.getPath(),h);var k=f.entities[g]||{};delete k.uuid;e.set(k);b.addEntity(e)}}if(typeof(a)==="function"){a(f)}}else{if(typeof(c)==="function"){c(f)}}},function(e){if(typeof(c)==="function"){c(e)}});Usergrid.ApiClient.runAppQuery(this)};Usergrid.Collection.prototype.save=function(a,b){var e=this.getEntityList();var d=e.length;var f=[];for(var c=0;c<d;c++){entity=e[c];data=entity.get();if(entity.get("uuid")){data.uuid=entity.get("uuid");f.push(data)}entity.save()}this.setAllQueryParams("PUT",this.getPath(),f,null,a,b);Usergrid.ApiClient.runAppQuery(this)}})(Usergrid);Usergrid.M="ManagementQuery";Usergrid.A="ApplicationQuery";Usergrid.ApiClient=(function(){var u="https://api.usergrid.com/";var t=null;var O=null;var o=null;var D=30000;var K=null;var z=null;var w=null;var e=null;function L(Q,P){this.setOrganizationName(Q);this.setApplicationName(P)}function E(P){var Q="/"+this.getOrganizationName()+"/"+this.getApplicationName()+"/";x(Usergrid.A);r(P,Q)}function k(P){var Q="/management/";x(Usergrid.M);r(P,Q)}function n(){return t}function m(P){t=P}function C(){return O}function a(P){O=P}function l(){return o}function f(P){o=P}function N(){return u}function b(P){u=P}function c(){return D}function I(P){D=P}function q(P){e=P}function y(){return e}function B(P){if(e&&typeof(e)==="function"){e(P);return true}else{return false}}function g(){return N()+"/management/users/resetpw"}function G(){return this._loggedInUser}function d(P){this._loggedInUser=P}function s(U,R,P,T){var Q=this;var S={username:U,password:R,grant_type:"password"};this.runAppQuery(new Usergrid.Query("GET","token",null,S,function(W){var V=new Usergrid.Entity("users");V.set("username",W.user.username);V.set("name",W.user.name);V.set("email",W.user.email);V.set("uuid",W.user.uuid);Q.setLoggedInUser(V);Q.setToken(W.access_token);if(P&&typeof(P)==="function"){P(W)}},function(V){if(T&&typeof(T)==="function"){T(V)}}))}function J(){}function h(){this.setLoggedInUser(null);this.setToken(null)}function A(){var P=this.getLoggedInUser();return(this.getToken()&&Usergrid.validation.isUUID(P.get("uuid")))}function p(){return w}function F(P){w=P}function H(){if(w&&typeof(w)==="function"){w();return true}else{return false}}function M(S){tail=[];var Q=[];if(S instanceof Array){for(i in S){Q=S[i];if((Q instanceof Array)&&(Q.length>1)){tail.push(Q[0]+"="+encodeURIComponent(Q[1]))}}}else{for(var P in S){if(S.hasOwnProperty(P)){var R=S[P];if(R instanceof Array){for(i in R){Q=R[i];tail.push(P+"="+encodeURIComponent(Q))}}else{tail.push(P+"="+encodeURIComponent(R))}}}}return tail.join("&")}function j(){return K}function x(P){K=P}function r(V,ab){var Q="curl";try{if(!(V instanceof Usergrid.Query)){throw (new Error("Query is not a valid object."))}V.setQueryStartTime();var P=V.getMethod().toUpperCase();var ac=V.getResource();var aa=V.getJsonObj()||{};var S=V.getQueryParams()||{};if(P!="GET"&&P!="POST"&&P!="PUT"&&P!="DELETE"){throw (new Error("Invalid method - should be GET, POST, PUT, or DELETE."))}if(P=="POST"){Q+=" -X POST"}else{if(P=="PUT"){Q+=" -X PUT"}else{if(P=="DELETE"){Q+=" -X DELETE"}else{Q+=" -X GET"}}}var T=Usergrid.ApiClient.getApplicationName();if(T){T=T.toUpperCase()}if((T!="SANDBOX"&&Usergrid.ApiClient.getToken())||(j()==Usergrid.M&&Usergrid.ApiClient.getToken())){Q+=' -i -H "Authorization: Bearer '+Usergrid.ApiClient.getToken()+'"';V.setToken(true)}_params=JSON.stringify(S);if(!JSON.parse(_params)){throw (new Error("Params object is not valid."))}if(V.getCursor()){S.cursor=V.getCursor()}else{delete S.cursor}ab=ab.indexOf("/")==0?ab.substring(1):ab;ac=ab+ac;if(ac){while(ac.indexOf("//")!=-1){ac=ac.replace("//","/")}}ac=Usergrid.ApiClient.getApiUrl()+ac;Q+=' "'+ac;var U=M(S);if(U){Q+="?"+U}Q+='"';if((P=="GET")||(P=="DELETE")){S._=new Date().getTime()}var Z=M(S);if(Z){ac+="?"+Z}aa=JSON.stringify(aa);if(!JSON.parse(aa)){throw (new Error("JSON object is not valid."))}if(aa=="{}"){aa=null}else{Q+=" -d '"+aa+"'"}}catch(W){console.log("error occured running query -"+W.message);return false}console.log(Q);V.setCurl(Q);var R=window.XDomainRequest?true:false;var Y=v(P,ac,aa);Y.onerror=function(){V.setQueryEndTime();console.log(V.getQueryTotalTime());clearTimeout(X);console.log("API call failed at the network level.");V.callFailureCallback(response.innerText)};Y.xdomainOnload=function(ad){V.setQueryEndTime();console.log("Call timing: "+V.getQueryTotalTime());clearTimeout(X);ad=JSON.parse(Y.responseText);try{var af=ad.cursor||null;V.saveCursor(af)}catch(ae){}V.callSuccessCallback(ad)};Y.onload=function(ad){V.setQueryEndTime();console.log("Call timing: "+V.getQueryTotalTime());clearTimeout(X);ad=JSON.parse(Y.responseText);if(Y.status!=200&&!R){try{var ae=ad.error;console.log("API call failed: (status: "+Y.status+")."+ae.type);if((ae.type=="auth_expired_session_token")||(ae.type=="unauthorized")||(ae.type=="auth_missing_credentials")||(ae.type=="auth_invalid")){H()}}catch(af){}V.callFailureCallback(ad.error_description);return}else{var ag=ad.cursor||null;V.saveCursor(ag);V.callSuccessCallback(ad)}};var X=setTimeout(function(){Y.abort();if(Usergrid.ApiClient.getCallTimeoutCallback()==="function"){Usergrid.ApiClient.callTimeoutCallback("API CALL TIMEOUT")}else{V.callFailureCallback("API CALL TIMEOUT")}},Usergrid.ApiClient.getCallTimeout());Y.send(aa)}function v(S,P,R){var Q;if(window.XDomainRequest){Q=new window.XDomainRequest();if(Usergrid.ApiClient.getToken()){if(P.indexOf("?")){P+="&access_token="+Usergrid.ApiClient.getToken()}else{P="?access_token="+Usergrid.ApiClient.getToken()}}Q.open(S,P,true)}else{Q=new XMLHttpRequest();Q.open(S,P,true);if(R){Q.setRequestHeader("Content-Type","application/json")}if(Usergrid.ApiClient.getToken()){Q.setRequestHeader("Authorization","Bearer "+Usergrid.ApiClient.getToken());Q.withCredentials=true}}return Q}return{init:L,runAppQuery:E,runManagementQuery:k,getOrganizationName:n,setOrganizationName:m,getApplicationName:C,setApplicationName:a,getToken:l,setToken:f,getCallTimeout:c,setCallTimeout:I,getCallTimeoutCallback:y,setCallTimeoutCallback:q,callTimeoutCallback:B,getApiUrl:N,setApiUrl:b,getResetPasswordUrl:g,getLoggedInUser:G,setLoggedInUser:d,logInAppUser:s,renewAppUserToken:J,logoutAppUser:h,isLoggedInAppUser:A,getLogoutCallback:p,setLogoutCallback:F,callLogoutCallback:H}})();Usergrid.validation=(function(){var q=new RegExp("^([0-9a-zA-Z.-])+$");var a=new RegExp("^([0-9a-zA-Z@#$%^&!?;:.,'\"~*-=+_[\\](){}/\\ |])+$");var n=new RegExp("^(([0-9a-zA-Z]+[_+.-]?)+@[0-9a-zA-Z]+[0-9,a-z,A-Z,.,-]*(.){1}[a-zA-Z]{2,4})+$");var d=new RegExp("^([0-9a-zA-Z@#$%^&!?<>;:.,'\"~*-=+_[\\](){}/\\ |])+$");var m=new RegExp("^([0-9a-z./-])+$");var f=new RegExp("^([0-9a-zA-Z.!-?/])+$");function g(w,v){if(q.test(w)&&s(w,4,80)){return true}else{if(v&&typeof(v)==="function"){v(this.getUsernameAllowedChars())}return false}}function c(){return"Length: min 4, max 80. Allowed: A-Z, a-z, 0-9, dot, and dash"}function b(v,w){if(a.test(v)&&s(v,4,16)){return true}else{if(w&&typeof(w)==="function"){w(this.getNameAllowedChars())}return false}}function p(){return"Length: min 4, max 80. Allowed: A-Z, a-z, 0-9, ~ @ # % ^ & * ( ) - _ = + [ ] { } \\ | ; : ' \" , . / ? !"}function e(v,w){if(d.test(v)&&s(v,5,16)){return true}else{if(w&&typeof(w)==="function"){w(this.getPasswordAllowedChars())}return false}}function l(){return"Length: min 5, max 16. Allowed: A-Z, a-z, 0-9, ~ @ # % ^ & * ( ) - _ = + [ ] { } \\ | ; : ' \" , . < > / ? !"}function o(v,w){if(n.test(v)&&s(v,4,80)){return true}else{if(w&&typeof(w)==="function"){w(this.getEmailAllowedChars())}return false}}function j(){return"Email must be in standard form: e.g. example@Usergrid.com"}function r(v,w){if(m.test(v)&&s(v,4,80)){return true}else{if(w&&typeof(w)==="function"){w(this.getPathAllowedChars())}return false}}function h(){return"Length: min 4, max 80. Allowed: /, a-z, 0-9, dot, and dash"}function u(w,v){if(f.test(w)&&s(w,4,80)){return true}else{if(v&&typeof(v)==="function"){v(this.getTitleAllowedChars())}return false}}function k(){return"Length: min 4, max 80. Allowed: space, A-Z, a-z, 0-9, dot, dash, /, !, and ?"}function s(w,x,v){if(w.length>v||w.length<x){return false}return true}function t(v){var w=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;if(!v){return false}return w.test(v)}return{validateUsername:g,getUsernameAllowedChars:c,validateName:b,getNameAllowedChars:p,validatePassword:e,getPasswordAllowedChars:l,validateEmail:o,getEmailAllowedChars:j,validatePath:r,getPathAllowedChars:h,validateTitle:u,getTitleAllowedChars:k,isUUID:t}})();